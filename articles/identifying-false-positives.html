<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="motus">
<title>A tool to identify probable false positive detections • motus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A tool to identify probable false positive detections">
<meta property="og:description" content="motus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">motus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">6.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/motus.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01-introduction.html">Chapter 1 - Introduction</a>
    <a class="dropdown-item" href="../articles/02-installing-packages.html">Chapter 2 - Installing packages</a>
    <a class="dropdown-item" href="../articles/03-accessing-data.html">Chapter 3 - Accessing detections data</a>
    <a class="dropdown-item" href="../articles/04-deployments.html">Chapter 4 - Tag and receiver deployments</a>
    <a class="dropdown-item" href="../articles/05-data-cleaning.html">Chapter 5 - Data Cleaning</a>
    <a class="dropdown-item" href="../articles/06-exploring-data.html">Chapter 6 - Exploring detections data</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/troubleshooting.html">Troubleshooting</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MotusWTS/motus/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>A tool to identify probable false positive detections</h1>
                        <h4 data-toc-skip class="author">Bianca Michalik
and Amie MacDonald</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MotusWTS/motus/blob/HEAD/vignettes/articles/identifying-false-positives.Rmd" class="external-link"><code>vignettes/articles/identifying-false-positives.Rmd</code></a></small>
      <div class="d-none name"><code>identifying-false-positives.Rmd</code></div>
    </div>

    
    
<p><strong>Note:</strong> <em>This is a living document that may be
updated in the future to incorporate improved knowledge about predictors
of false positives and further validation of training datasets.</em></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>As outlined in <a href="05-data-cleaning.html">Chapter 5</a>, there
are several factors that might lead to false detections of your tags in
your datasets. One type of these false detections are <em>false
positives</em>, which can arise from other sources of electromagnetic
pulses in the surroundings of receiving antennas. False positives are
liberally allowed for during automated tag filtering at Motus to
minimize the risk of missing any real detections. Therefore, we
generally recommend you use the tools provided in <a href="05-data-cleaning.html#assess-tag-detections">Chapter 5</a> to
validate your data and to decide individually if a detection is valid in
a biological context. However, examining each tag individually for
suspect detections can be quite time consuming, especially when you are
fortunate enough to have deployed many tags. Furthermore, it is
important to record the conditions under which you excluded a detection
for transparency and reproducibility. This method facilitates recording
the conditions of exclusion, though it is certainly also possible to do
so with a little extra work when using visual inspection of diagnostic
plots to identify false positives.</p>
<p>The goal of this chapter is to provide a tool to predict the
probability of a detection being a false positive. The concept of our
approach is quite simple: first, we want to use a subset of detection
data from a solid <em>a priori</em> classification of detections either
being ‘good’ or ‘bad’. In the second step, we want to identify potential
diagnostic physical parameters provided in the Motus
<code>alltags</code> table (please see <a href="database-variables.html">Database Variables</a> for a detailed
description of variables) to characterize the quality of a detection.
Third, we run a logistic regression model with these parameters in order
to predict the probability of each detection being a ‘bad’ detection for
all of your detection data. Finally, you can use the probability
estimates provided from the model to define a threshold for filtering
your data. Of course, it is advisable to re-evaluate the outcome of this
process in a biological context.</p>
<p>While this chapter primarily applies to detection of Lotek nanotags,
detections from Cellular Tracking Technologies (CTT) tags are also
subject to false detections. Because the properties and the processing
of the data are quite distinct, the topic of false detections in CTT
tags will be covered in a different chapter at a later time. However,
some of the principles explained here will apply to both types of tags,
particularly the idea that longer, uninterrupted sequences of bursts
matching the expected burst period will have a higher probability of
being true detections.</p>
</div>
<div class="section level2">
<h2 id="step-1-classification-of-detections">Step 1 – Classification of detections<a class="anchor" aria-label="anchor" href="#step-1-classification-of-detections"></a>
</h2>
<p>False positives resulting from random radio noise are often
characterized by three simultaneously occurring features. First, the run
lengths of these false detections are typically quite short. A ‘run’ is
a series of bursts of a given tag detected by the same antenna at the
same receiver. Short run lengths mean that only a few recorded bursts
are identified to match a specific tag. This feature arises from simple
probability statistics: in a series of random pulses it is more likely
to find the specific signal pattern of a tag only by chance if that
pattern is short. The detection probability of a deployed tag also
depends on its burst interval, meaning that longer burst intervals have
a lower probability of being detected. Tags with long burst intervals
tend to be recorded less often as the animal moves ‘out of the beam’ of
the recording antenna. Tags with short burst intervals, in turn, tend to
be recorded with a longer run length.</p>
<p>The second common feature of false detections is that within a run a
lot of bursts are missed. During the process of automated tag filtering
up to 60 bursts can be missed without the run being terminated for the
identified tag. This makes biological sense as the detection probability
of a tag deployed on a moving animal also depends on the structure and
type of the landscape, the orientation of the antenna of the tag as well
as on the distance and height the animal is moving relative to the
recording antenna. If the animal drops in height, vanishes behind a
structure or if it quickly turns its body axis, recordings of the tag
can be interrupted, i.e. bursts can be missed. Recordings with a very
high amount of missed bursts, however, might be less trustworthy.</p>
<p>The third feature is that the time intervals of the detected bursts
might not properly match the time intervals recorded during tag
registration. If you calculate ‘measured’ burst intervals between two
subsequently recorded bursts of the same tag, i.e. ignoring missed
bursts, they sometimes deviate widely from the burst interval as
specified by the manufacturer and tag registration. Many missed bursts
will result in an average ‘measured’ burst interval substantially larger
than the expected burst interval of the tag and may be indicative of a
false positive.</p>
<p>As pointed out, none of the three common features of false positives
described above can alone describe the quality of a detection. We thus
want to use all three of them to classify our detection dataset <em>a
priori</em> into ‘good’ and ‘bad’ detections.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set system environment time zone to GMT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>tz<span class="op">=</span><span class="st">"GMT"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://motuswts.github.io/motus/">motus</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/" class="external-link">rms</a></span><span class="op">)</span> <span class="co"># For modelling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set base theme for plots</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### download sample data from James Bay Shorebird Project #176</span></span>
<span><span class="co">#   note: if you haven't downloaded sample dataset before, use 'new = T'</span></span>
<span><span class="co">#   login name and password are both 'motus.sample'</span></span>
<span><span class="co">#   specify 'dir =' to save elsewhere than working directory</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tagme.html">tagme</a></span><span class="op">(</span><span class="fl">176</span>, update <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"alltags"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">tagDeployID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                              <span class="co"># remove tags with no deployment or burst interval</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hitID</span>, <span class="va">runID</span>, <span class="va">ts</span>, <span class="va">sig</span>, <span class="va">sigsd</span>, <span class="va">noise</span>, <span class="va">freq</span>, <span class="va">freqsd</span>, <span class="va">slop</span>, <span class="va">burstSlop</span>,   <span class="co"># select variables</span></span>
<span>         <span class="va">motusTagID</span>, <span class="va">port</span>, <span class="va">runLen</span>, <span class="va">tagModel</span>, <span class="va">tagBI</span>, <span class="va">tagDeployID</span>,</span>
<span>         <span class="va">deviceID</span>, <span class="va">recvDeployID</span>, <span class="va">recvDeployLat</span>, <span class="va">recvDeployLon</span>, <span class="va">recv</span>, <span class="va">recvSiteName</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">motusTagID</span>, <span class="va">ts</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                                  <span class="co"># order data frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                               <span class="co"># convert into flat data frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ts <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_datetime</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>      <span class="co"># convert ts into date-time format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="co"># Remove this object now that we're done with it</span></span></code></pre></div>
<p>Before proceeding, we want to ensure there are no duplicate runs. If
there are, these may be due to deprecated batches (see <a href="deprecated-batches.html">Removing deprecated batches</a> for
details). We will remove any deprecated batches, leaving only the most
recently processed data in our dataset.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find duplicated runIDs (duplicates in ts, motusTagID, port, recv)</span></span>
<span><span class="va">runsDup</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ts</span>, <span class="va">motusTagID</span>, <span class="va">port</span>, <span class="va">recv</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check for deprecated batches</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"deprecated"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update SQL database by removing deprecated batches</span></span>
<span><span class="co"># select 1 (Yes)</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/deprecateBatches.html">deprecateBatches</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update flat dataframe so it doesn't have duplicated runs due to deprecated batches</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"alltags"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">tagDeployID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                              <span class="co"># remove tags with no deployment or burst interval</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hitID</span>, <span class="va">runID</span>, <span class="va">ts</span>, <span class="va">sig</span>, <span class="va">sigsd</span>, <span class="va">noise</span>, <span class="va">freq</span>, <span class="va">freqsd</span>, <span class="va">slop</span>, <span class="va">burstSlop</span>,   <span class="co"># select variables</span></span>
<span>         <span class="va">motusTagID</span>, <span class="va">port</span>, <span class="va">runLen</span>, <span class="va">tagModel</span>, <span class="va">tagBI</span>, <span class="va">tagDeployID</span>,</span>
<span>         <span class="va">deviceID</span>, <span class="va">recvDeployID</span>, <span class="va">recvDeployLat</span>, <span class="va">recvDeployLon</span>, <span class="va">recv</span>, <span class="va">recvSiteName</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">motusTagID</span>, <span class="va">ts</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                                  <span class="co"># order data frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>                                               <span class="co"># convert into flat data frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ts <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html" class="external-link">as_datetime</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>      <span class="co"># convert ts into date-time format</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span>  <span class="co"># Remove this object</span></span>
<span></span>
<span><span class="co"># confirm there are no longer duplicated runIDs</span></span>
<span><span class="va">runsDup</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ts</span>, <span class="va">motusTagID</span>, <span class="va">port</span>, <span class="va">recv</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">runsDup</span><span class="op">)</span></span></code></pre></div>
<p>Since we want to consider each detection within its recorded time
frame, we calculate features 2 and 3 for each run individually.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##### Step 1 - Classification of detections</span></span>
<span></span>
<span><span class="co">### calculate features 2 and 3 for each run</span></span>
<span><span class="va">runFeat</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         nPred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">duration</span><span class="op">/</span><span class="va">tagBI</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,           <span class="co"># expected number of bursts in run if none are missed</span></span>
<span>         nMiss <span class="op">=</span> <span class="va">nPred</span> <span class="op">-</span> <span class="va">runLen</span>,                        <span class="co"># number of bursts missed in run</span></span>
<span>         propMiss <span class="op">=</span> <span class="va">nMiss</span><span class="op">/</span><span class="va">nPred</span>,                        <span class="co"># feature 2 - proportion of bursts missed in run</span></span>
<span>         meanBI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,           <span class="co"># mean observed burst interval of all intervals between sequential bursts in a run</span></span>
<span>         deltaMeanBI <span class="op">=</span> <span class="va">meanBI</span> <span class="op">-</span> <span class="va">tagBI</span>,                  <span class="co"># feature 3 - difference between observed mean burst interval and expected burst interval recorded at tag registration</span></span>
<span>         log10runLen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">runLen</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>               <span class="co"># log10 of runLen for better visualization</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">runID</span>, <span class="va">motusTagID</span>, <span class="va">port</span>, <span class="va">runLen</span>, <span class="va">tagModel</span>, <span class="va">tagBI</span>,</span>
<span>         <span class="va">recv</span>, <span class="va">recvSiteName</span>, <span class="va">recvDeployLat</span>, <span class="va">recvDeployLon</span>,</span>
<span>         <span class="va">duration</span>, <span class="va">nPred</span>, <span class="va">nMiss</span>, <span class="va">propMiss</span>, <span class="va">meanBI</span>, <span class="va">deltaMeanBI</span>, <span class="va">log10runLen</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can classify our dataset of runs into the <em>a priori</em>
categories ‘good’, ‘bad’ and ‘unassigned’. We use a simple if-else
statement and threshold values for each of the three features. Of
course, threshold setting is up to you. We recommend a conservative
classification of ‘good’ runs having less than 25% of the bursts missed
or the deviation between the recorded mean burst interval and the tag
burst interval should be smaller than the tag burst interval itself.
‘Bad’ runs are those recorded with run lengths smaller than 4, more than
75% of the bursts missed, or the deviation between the recorded mean
burst interval is more than 3 times the tag burst interval.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### assign category for goodness of detection (run)</span></span>
<span><span class="co">#   filter by propMiss &gt;= 0.75, deltaMeanBI &gt;= 3*tagBI, runLen &lt; 4</span></span>
<span><span class="va">runFeat</span><span class="op">$</span><span class="va">category</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">propMiss</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.75</span> <span class="op">|</span></span>
<span>                               <span class="va">runFeat</span><span class="op">$</span><span class="va">deltaMeanBI</span> <span class="op">&gt;</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">runFeat</span><span class="op">$</span><span class="va">tagBI</span> <span class="op">|</span></span>
<span>                               <span class="va">runFeat</span><span class="op">$</span><span class="va">runLen</span> <span class="op">&lt;</span> <span class="fl">4</span>, <span class="st">"bad"</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">propMiss</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.25</span> <span class="op">|</span></span>
<span>                                      <span class="va">runFeat</span><span class="op">$</span><span class="va">deltaMeanBI</span> <span class="op">&lt;</span> <span class="va">runFeat</span><span class="op">$</span><span class="va">tagBI</span>,</span>
<span>                                      <span class="st">"good"</span>, <span class="st">"unassigned"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To validate your threshold classification, you can make frequency
distribution plots for each of the three features for <em>a priori</em>
categories ‘good’, ‘bad’, and ‘unassigned’. We can log transform run
length for better visibility.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># some diagnostic plots</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log10runLen"</span>, <span class="st">"propMiss"</span>, <span class="st">"deltaMeanBI"</span><span class="op">)</span>,</span>
<span>                                   each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">log10runLen</span>, <span class="va">runFeat</span><span class="op">$</span><span class="va">propMiss</span>, <span class="va">runFeat</span><span class="op">$</span><span class="va">deltaMeanBI</span><span class="op">)</span>,</span>
<span>                       category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">category</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#%&gt;%</span></span>
<span>  <span class="co">#filter(category != "unassigned") # uncomment the %&gt;% filter() statement to ignore the 'unassigned'</span></span>
<span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plotdata</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, group <span class="op">=</span> <span class="va">category</span>, colour <span class="op">=</span> <span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="identifying-false-positives_files/figure-html/unnamed-chunk-5-1.png" width="1152"></p>
</div>
<div class="section level2">
<h2 id="step-2-identification-of-potential-diagnostic-parameters">Step 2 – Identification of potential diagnostic parameters<a class="anchor" aria-label="anchor" href="#step-2-identification-of-potential-diagnostic-parameters"></a>
</h2>
<p>The Motus <code>alltags</code> table provides some physical
parameters, such as <code>sigsd</code>, <code>noise</code>,
<code>freqsd</code>, <code>slop</code>, <code>burstSlop</code> for each
detection hit (see <a href="https://motuswts.github.io/motus/articles/database-variables.html">Database
Variables</a> for detailed explanation of variables). We can calculate
the mean values of each parameter for each run and check graphically if
they can be used to describe the quality of the recorded run.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##### Step 2 - Identification of potential diagnostic parameters</span></span>
<span></span>
<span><span class="co">### calculate run mean values for</span></span>
<span><span class="co">#   'sigsd', 'noise', 'freqsd', 'slop', 'burstSlop'</span></span>
<span><span class="va">runTemp</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>meanTs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span>,</span>
<span>         meanSigSD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sigsd</span><span class="op">)</span>,</span>
<span>         meanNoise <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">noise</span><span class="op">)</span>,</span>
<span>         meanFreqSD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">freqsd</span><span class="op">)</span>,</span>
<span>         meanSlop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">slop</span><span class="op">)</span>,</span>
<span>         meanBurstSlop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">burstSlop</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">runID</span>, <span class="va">meanTs</span>, <span class="va">meanSigSD</span>, <span class="va">meanNoise</span>, <span class="va">meanFreqSD</span>, <span class="va">meanSlop</span>, <span class="va">meanBurstSlop</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op">==</span> <span class="cn">F</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">runFeat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">runFeat</span>, <span class="va">runTemp</span>, by <span class="op">=</span> <span class="st">"runID"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">runTemp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot variables (visual inspection of informative content)</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"meanSigSD"</span>, <span class="st">"meanNoise"</span>, <span class="st">"meanFreqSD"</span>,</span>
<span>                                     <span class="st">"meanSlop"</span>, <span class="st">"meanBurstSlop"</span><span class="op">)</span>,</span>
<span>                                   each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">meanSigSD</span>, <span class="va">runFeat</span><span class="op">$</span><span class="va">meanNoise</span>,</span>
<span>                                 <span class="va">runFeat</span><span class="op">$</span><span class="va">meanFreqSD</span>, <span class="va">runFeat</span><span class="op">$</span><span class="va">meanSlop</span>,</span>
<span>                                 <span class="va">runFeat</span><span class="op">$</span><span class="va">meanBurstSlop</span><span class="op">)</span>,</span>
<span>                       category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">category</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#%&gt;%</span></span>
<span>  <span class="co">#filter(category != "unassigned") # uncomment the %&gt;% filter() statement to ignore the 'unassigned'</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plotdata</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, group <span class="op">=</span> <span class="va">category</span>, colour <span class="op">=</span> <span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span></span></code></pre></div>
<p><img src="identifying-false-positives_files/figure-html/unnamed-chunk-6-1.png" width="1152"></p>
<p>Motus allows a certain time offset (±4 ms) between the observed burst
interval and the expected burst interval recorded at tag registration
(<code>burstSlop</code>) during automated data processing. Similarly,
<code>slop</code> refers to the deviation in timing of inter-pulse
intervals within a burst and a total absolute difference of 1.5 ms
between observed and expected bursts is permitted during automated data
processing. Therefore, we might expect false positives to have greater
absolute values for <code>burstSlop</code> and <code>slop</code>, while
true detections would have values closer to zero. We also might expect
to see false positives have a greater standard deviation of the offset
of frequencies from the expected tag frequency than true detections,
which appears to be the case in the plot above. <code>Noise</code> is an
estimate of the background radio noise, which does not appear to vary
drastically between true and false detections in this case, but may be a
valuable predictor for other datasets. Interestingly for this dataset,
the standard deviation in signal strength among pulses in a burst
appears to be similar for detections we classified <em>a priori</em> as
true or false, but higher for detections we did not classify.</p>
<p>There are, of course, other factors that can help to validate the
detection. We will examine two that we expect to be explanatory,
noisiness and continuity, and create additional variables to describe
these factors. We consider times when there are many recordings at a
given receiver to be noisy. We can use the <code>activity</code> table
to identify the number of runs and their lengths for each antenna of
each receiver recorded per hour. We can get a more complete picture of
noisiness using the <code>activity</code> table because it includes
numbers of runs across all projects, not just our own. We can also
calculate ‘proportion of short run lengths in runs per receiver hour’
and link the data from the <code>activity</code> table back to the runs
in the <code>alltags</code> table via the <code>runs</code> table by
calculating the <code>hourBin</code> for each <code>runID</code>. This
allows us to connect the information on noise in the
<code>activity</code> table back to our detection data. In addition,
there might be a propensity for some tags to be recorded with short run
lengths, i.e. detections resulting from noise. We can therefore
calculate for each tag a variable for the overall ‘proportion of short
run lengths’.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get activity table</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"activity"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>                                              <span class="co"># convert into flat data frame</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get runs table</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">db</span>, <span class="st">"runs"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rdf</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>hourBin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">tsBegin</span><span class="op">/</span><span class="fl">3600</span><span class="op">)</span><span class="op">)</span>                                <span class="co"># calculate hourBin for each run</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join runs and activity tables to get hourly values on runs/recv for each runID</span></span>
<span><span class="va">radf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">rdf</span>, <span class="va">adf</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"batchIDbegin"</span> <span class="op">=</span> <span class="st">"batchID"</span>, <span class="st">"ant"</span>, <span class="st">"hourBin"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join with detection data</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">radf</span>, <span class="va">runID</span>, <span class="va">numRuns</span>, <span class="va">numHits</span>, <span class="va">run2</span>, <span class="va">run3</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"runID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### calculate 'noise' variables with values from activity table</span></span>
<span><span class="va">runTemp</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>propRS <span class="op">=</span> <span class="op">(</span><span class="va">run2</span> <span class="op">+</span> <span class="va">run3</span><span class="op">)</span><span class="op">/</span><span class="va">numRuns</span>, <span class="co"># proportion of short runs per receiver hour</span></span>
<span>         log10numRuns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">numRuns</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># log transform for better visibility </span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">motusTagID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tagPropRS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">runID</span><span class="op">[</span><span class="va">runLen</span><span class="op">&lt;</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># tags’ proportion of short runs</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">runID</span>, <span class="va">numRuns</span>, <span class="va">propRS</span>, <span class="va">tagPropRS</span>, <span class="va">log10numRuns</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">runFeat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">runFeat</span>, <span class="va">runTemp</span>, by <span class="op">=</span> <span class="st">"runID"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">runTemp</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot variables</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"log10numRuns"</span>, <span class="st">"propRS"</span>, <span class="st">"tagPropRS"</span><span class="op">)</span>,</span>
<span>                                   each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">log10numRuns</span>, <span class="va">runFeat</span><span class="op">$</span><span class="va">propRS</span>, <span class="va">runFeat</span><span class="op">$</span><span class="va">tagPropRS</span><span class="op">)</span>,</span>
<span>                       category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">category</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#%&gt;%</span></span>
<span>  <span class="co">#filter(category != "unassigned") # uncomment the %&gt;% filter() statement to ignore the ‘unassigned’</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plotdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, group <span class="op">=</span> <span class="va">category</span>, colour <span class="op">=</span> <span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span></span></code></pre></div>
<p><img src="identifying-false-positives_files/figure-html/unnamed-chunk-7-1.png" width="1152"></p>
<p>In the plots above, we can see that detections we have classified as
false positives tend to have more runs per hour and a higher proportion
of short runs per hour. There is more overlap in distributions between
detections we have classified as ‘bad’ and ‘good’, though ‘bad’
detections appear to be associated with tags that have a lot of short
runs somewhat more frequently than ‘good’ detections.</p>
<p>The other factor that might have some importance and potential for
diagnostics is continuity. This means that recordings assigned to match
a certain tag may be more trustworthy if other recordings assigned to
the same tag happen in some time window at the same or another antenna
of the same receiver station. We thus calculate the number of runs and
the number of recording antenna ports assigned to the same tag within 25
minutes of the mean time stamp of the given run. You may choose to use a
longer or shorter time window.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### calculate 'continuity' variables</span></span>
<span><span class="va">runTemp</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>meanTs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">motusTagID</span>, <span class="va">recv</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nContRuns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">runID</span><span class="op">[</span><span class="va">ts</span> <span class="op">&lt;=</span> <span class="va">meanTs</span> <span class="op">+</span> <span class="fl">25</span><span class="op">*</span><span class="fl">60</span> <span class="op">|</span></span>
<span>                                         <span class="va">ts</span> <span class="op">&gt;=</span> <span class="va">meanTs</span> <span class="op">-</span> <span class="fl">25</span><span class="op">*</span><span class="fl">60</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         nPorts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">port</span><span class="op">[</span><span class="va">ts</span> <span class="op">&lt;=</span> <span class="va">meanTs</span> <span class="op">+</span> <span class="fl">25</span><span class="op">*</span><span class="fl">60</span> <span class="op">|</span></span>
<span>                                     <span class="va">ts</span> <span class="op">&gt;=</span> <span class="va">meanTs</span> <span class="op">-</span> <span class="fl">25</span><span class="op">*</span><span class="fl">60</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">runID</span>, <span class="va">nContRuns</span>, <span class="va">nPorts</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">runFeat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">runFeat</span>, <span class="va">runTemp</span>, by <span class="op">=</span> <span class="st">"runID"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">runTemp</span><span class="op">)</span></span></code></pre></div>
<p>We can check the importance of these new variables graphically
again.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot variables</span></span>
<span><span class="va">plotdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nContRuns"</span>, <span class="st">"nPorts"</span><span class="op">)</span>,</span>
<span>                                   each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">nContRuns</span>, <span class="va">runFeat</span><span class="op">$</span><span class="va">nPorts</span><span class="op">)</span>,</span>
<span>                       category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">runFeat</span><span class="op">$</span><span class="va">category</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#%&gt;%</span></span>
<span>  <span class="co">#filter(category != "unassigned") # uncomment the %&gt;% filter() statement to ignore the 'unassigned'</span></span>
<span></span>
<span></span>
<span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plotdata</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, group <span class="op">=</span> <span class="va">category</span>, colour <span class="op">=</span> <span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">plotdata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p4</span></span></code></pre></div>
<p><img src="identifying-false-positives_files/figure-html/unnamed-chunk-9-1.png" width="1152"></p>
</div>
<div class="section level2">
<h2 id="step-3-prediction-of-the-probability-of-being-a-false-positive">Step 3 – Prediction of the probability of being a false
positive<a class="anchor" aria-label="anchor" href="#step-3-prediction-of-the-probability-of-being-a-false-positive"></a>
</h2>
<p>From the plots produced above, we can examine which variables we
would like to include in our logistic regression model to predict the
probability of a given run being a false positive. The modelling
approach is quite simple: first, confine your created dataset to data
for either category ‘good’ or ‘bad’ and transform the category into a
binary variable. Make sure you have assigned ‘1’ to ‘bad’ and ‘0’ to
‘good’ in order to predict the probability of being a ‘bad’ detection!
Note the ‘unassigned’ category is ignored here as we now want to predict
the probabilities for these data. Second, run a binomial generalized
linear model over the variables you have selected based on the
diagnostic plots you have made before and store the results into another
variable. You can also calculate some goodness of fit parameters to
check the predictive power of your model fit. Finally, you can use the
stored model outcome to predict the estimated probability of being a
false positive for all runs in your detection data.</p>
<p>Note that our example model includes all variables mentioned above,
but we recommend you to carefully select powerful variables that might
best represent the characteristics of your own data. You may also want
to explore other potential variables that we do not include in this
example, such as tag model. Depending on the antenna of the tag, the
specified burst intervals or the transmitted power of the tag, different
tag types might bear different detection probabilities and consequently,
different probabilities of resulting in false detections. This only
makes sense, however, if different tag types are used, or if different
tag properties were assigned to different tag types. To better match
these to your data, you can use the date-bin of tag registration or
create your own variable.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##### Step 3 - Prediction of the probability of being a false positive</span></span>
<span></span>
<span><span class="va">modeldata</span> <span class="op">&lt;-</span> <span class="va">runFeat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">category</span> <span class="op">!=</span> <span class="st">"unassigned"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">category</span> <span class="op">==</span> <span class="st">"good"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="co"># basic model</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">category</span> <span class="op">~</span> <span class="va">meanSigSD</span> <span class="op">+</span> <span class="va">meanNoise</span> <span class="op">+</span> <span class="va">meanFreqSD</span> <span class="op">+</span> <span class="va">meanSlop</span> <span class="op">+</span> </span>
<span>           <span class="va">meanBurstSlop</span> <span class="op">+</span> <span class="va">numRuns</span> <span class="op">+</span> <span class="va">propRS</span> <span class="op">+</span> <span class="va">tagPropRS</span> <span class="op">+</span> <span class="va">nContRuns</span> <span class="op">+</span> <span class="va">nPorts</span>,</span>
<span>         data <span class="op">=</span> <span class="va">modeldata</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## glm(formula = category ~ meanSigSD + meanNoise + meanFreqSD + </span></span>
<span><span class="co">##     meanSlop + meanBurstSlop + numRuns + propRS + tagPropRS + </span></span>
<span><span class="co">##     nContRuns + nPorts, family = binomial(), data = modeldata)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                 Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)   -5.268e+00  8.388e-01  -6.281 3.37e-10 ***</span></span>
<span><span class="co">## meanSigSD     -6.660e-03  3.301e-03  -2.018  0.04361 *  </span></span>
<span><span class="co">## meanNoise     -4.414e-02  8.984e-03  -4.913 8.96e-07 ***</span></span>
<span><span class="co">## meanFreqSD     6.441e+00  2.113e+00   3.048  0.00230 ** </span></span>
<span><span class="co">## meanSlop       8.293e+02  1.518e+02   5.463 4.68e-08 ***</span></span>
<span><span class="co">## meanBurstSlop -6.672e+01  3.177e+01  -2.100  0.03572 *  </span></span>
<span><span class="co">## numRuns        5.039e-04  3.536e-04   1.425  0.15410    </span></span>
<span><span class="co">## propRS         3.709e+00  2.165e-01  17.132  &lt; 2e-16 ***</span></span>
<span><span class="co">## tagPropRS      1.379e+00  4.817e-01   2.862  0.00421 ** </span></span>
<span><span class="co">## nContRuns      7.446e-04  1.388e-04   5.365 8.09e-08 ***</span></span>
<span><span class="co">## nPorts        -2.346e-01  9.415e-02  -2.492  0.01270 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Null deviance: 4554.9  on 3395  degrees of freedom</span></span>
<span><span class="co">## Residual deviance: 3026.0  on 3385  degrees of freedom</span></span>
<span><span class="co">## AIC: 3048</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Fisher Scoring iterations: 9</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># goodness of fit parameters</span></span>
<span><span class="va">MRS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/lrm.html" class="external-link">lrm</a></span><span class="op">(</span><span class="va">category</span> <span class="op">~</span> <span class="va">meanSigSD</span> <span class="op">+</span> <span class="va">meanNoise</span> <span class="op">+</span> <span class="va">meanFreqSD</span> <span class="op">+</span> <span class="va">meanSlop</span> <span class="op">+</span> </span>
<span>           <span class="va">meanBurstSlop</span> <span class="op">+</span> <span class="va">numRuns</span> <span class="op">+</span> <span class="va">propRS</span> <span class="op">+</span> <span class="va">tagPropRS</span> <span class="op">+</span> <span class="va">nContRuns</span> <span class="op">+</span> <span class="va">nPorts</span>,</span>
<span>           data <span class="op">=</span> <span class="va">modeldata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MRS</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span> <span class="co"># Nagelkerke's pseudo R^2</span></span></code></pre></div>
<pre><code><span><span class="co">##        R2 </span></span>
<span><span class="co">## 0.4908672</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">modeldata</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predict probability of being a 'bad' run</span></span>
<span><span class="va">runFeat</span><span class="op">$</span><span class="va">probBad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">M</span>, <span class="va">runFeat</span>, <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<p>You can now plot the probability for each of the categories you have
defined in step 1 to visually check the validity of your predictions.
Ideally, runs of the category ‘good’ should have resulted in low
probability estimates, whereas runs of the category ‘bad’ should have
resulted in high probability estimates. There will likely also be some
overlap where some runs previously assigned as ‘bad’ will have low
probability estimates. Nevertheless, the two ‘good’ and ‘bad’ curves
should be clearly separated.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot predicted values (graphical inspection of goodness of fit)</span></span>
<span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">runFeat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">probBad</span>, group <span class="op">=</span> <span class="va">category</span>, colour <span class="op">=</span> <span class="va">category</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"estimate of probability of being a 'bad' run"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p5</span></span></code></pre></div>
<p><img src="identifying-false-positives_files/figure-html/unnamed-chunk-11-1.png" width="1152"></p>
<p>We can see that many runs we classified as ‘bad’ do have a high
probability of being false positives as predicted by the model and few
have low probabilities of being false positives, while more runs we
classified as ‘good’ have low probabilities of being false positives.
However, some runs of all categories have probabilities of being false
positives around 0.5. Selecting our predictor variables more judiciously
or defining stricter <em>a priori</em> classifications may improve the
separation of curves.</p>
<p>You could use this graph to define your own threshold probability to
filter false positives from your data. Make sure not to filter single
detections (i.e. by <code>hitID</code>), but to exclude all detections
within a run that match your filter criterion for your dataset, i.e. to
filter by <code>runID</code>. We generally recommend that afterward you
use the tools described in <a href="05-data-cleaning.html#assess-tag-detections">Chapter 5</a> to
check individually if a detection or run you have excluded by your
individual threshold settings may still be valid in a biological sense,
or if additional detections should be excluded.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### set individual threshold and filter detection data by run</span></span>
<span><span class="co"># find runIDs with probBad &lt; 0.7</span></span>
<span><span class="va">runsKeep</span> <span class="op">&lt;-</span> <span class="va">runFeat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">probBad</span> <span class="op">&lt;</span> <span class="fl">0.7</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">runID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># filter detection data</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">runID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">runsKeep</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">runsKeep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add threshold to plot of predicted values</span></span>
<span><span class="va">p5</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0.7</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span></span></code></pre></div>
<p><img src="identifying-false-positives_files/figure-html/unnamed-chunk-12-1.png" width="1152"></p>
<p><strong>Note:</strong> We used the three characteristics
<code>runLen</code>, <code>propMiss</code>, and <code>deltaMeanBI</code>
when assigning the <em>a priori</em> classification of detections for
the sample dataset (project 176), but these characteristics may not be
as appropriate for other datasets. There are, of course, other features
of false positives and you are invited to create your own set of
characteristics for your data. We highly recommend you examine your own
data carefully and think critically about how you classify your
detection data. This tool is designed to help you detect false positives
and speed processing of large datasets, but it is not a
one-size-fits-all solution—a careful examination of your dataset and
carefully considered selection of classification criteria and predictor
variables is absolutely necessary. For example, you might consider
classifying ‘bad’ detections as those where over 85% of detections per
hour are short runs or where a receiver records more than 100 runs per
hour (i.e. a noisy site—similar to how the <code>motusFilter</code> and
the <code>filterByActivity</code> function work), and good detections as
those where fewer than 50% of detections per hour are short runs. In
this case you would be using some of the ‘noise’ variables calculated
below as classification features, so you must exclude them as predictor
variables. Instead, you could consider some of the features we used in
this example to classify the detections (<code>runLen</code>,
<code>propMiss</code>, and <code>meanDeltaBI</code>), as potential
predictor variables.</p>
<div class="section level3">
<h3 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h3>
<p>Phil Taylor proposed ideas on identifying false positives that
provided the foundation for this chapter. Adam Smith, Sjoerd Duijns,
Lucas Berrigan, and Denis Lepage provided valuable feedback and
discussions that contributed to this chapter.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Birds Canada, John Brzustowski, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
