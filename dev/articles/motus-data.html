<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="motus">
<title>Understanding Motus Data • motus</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Understanding Motus Data">
<meta property="og:description" content="motus">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">motus</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">6.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/motus.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/01-introduction.html">Chapter 1 - Introduction</a>
    <a class="dropdown-item" href="../articles/02-installing-packages.html">Chapter 2 - Installing packages</a>
    <a class="dropdown-item" href="../articles/03-accessing-data.html">Chapter 3 - Accessing detections data</a>
    <a class="dropdown-item" href="../articles/04-deployments.html">Chapter 4 - Tag and receiver deployments</a>
    <a class="dropdown-item" href="../articles/05-data-cleaning.html">Chapter 5 - Data Cleaning</a>
    <a class="dropdown-item" href="../articles/06-exploring-data.html">Chapter 6 - Exploring detections data</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/troubleshooting.html">Troubleshooting</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MotusWTS/motus/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Understanding Motus Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MotusWTS/motus/blob/HEAD/vignettes/articles/motus-data.Rmd" class="external-link"><code>vignettes/articles/motus-data.Rmd</code></a></small>
      <div class="d-none name"><code>motus-data.Rmd</code></div>
    </div>

    
    
<blockquote>
<p><strong>Note: </strong></p>
<p>This document was originally called “Bird’s eye view of Motus data”
and was was been adapted from a version written by John Brzustowsky in
2017. It provides an overview of the fundamentals of how Motus data
processing works. The document has been adapted to incorporate more
recent developments, particularly the addition of new digital tags and
base stations manufactured by Cellular Tracking Technologies (CTT), who
took over the development from Cornell University.</p>
</blockquote>
<div class="section level2">
<h2 id="basic-terms">Basic terms<a class="anchor" aria-label="anchor" href="#basic-terms"></a>
</h2>
<p><strong>Hardware</strong></p>
<ul>
<li>
<strong>Tags</strong> - Attached to an animal, emits radio signals
<ul>
<li>There are two types of tags, Lotek and CTT, which operate and are
processed differently.</li>
</ul>
</li>
<li>
<strong>Receivers</strong> - On the landscape, receive signals
collected by antennas</li>
<li>
<strong>Antennas</strong> - Attached to a receiver, detect different
signals emitted by tags</li>
<li>
<strong>Nodes</strong> - Special antennas for CTT receivers</li>
</ul>
<p><strong>Data</strong></p>
<ul>
<li>
<strong>Hits</strong> - An individual detection of a tag signal by
an antenna</li>
<li>
<strong>Runs</strong> - A series of hits for specific tag</li>
<li>
<strong>Batches</strong> - A collection of hits/runs which were
processed together</li>
</ul>
<p>To better understand these terms, let’s look at a visual of the
data.</p>
</div>
<div class="section level2">
<h2 id="understanding-the-data">Understanding the data<a class="anchor" aria-label="anchor" href="#understanding-the-data"></a>
</h2>
<div class="section level3">
<h3 id="hits-and-runs">Hits and Runs<a class="anchor" aria-label="anchor" href="#hits-and-runs"></a>
</h3>
<p>Here’s a segment of data from a receiver (with a two antennas):</p>
<pre><code>Receiver R
                                     Time -&gt;
       \=============================================================\
Tag A: / 1-----1--1----1-----1-----1         4---4----4--4------4--4-/ &lt;- antenna #1
       \                                                             \
Tag B: /               3-----3--3--3--3--3-----3----3--3             / &lt;- antenna #1
       \                                                             \
Tag C: /  2--2---2--2--2--2--2--2--2--2--2--2--2--2--2--2--2--2--2   / &lt;- antenna #1
       \                                                             \
Tag C: /            5--------5--5--5--5--5--5-----5-------5-------5  / &lt;- antenna #2
       \=============================================================\</code></pre>
<ul>
<li>Each row represents an individual <strong>tag</strong> (left) on a
specific <strong>antenna</strong> (right)</li>
<li>Each individual number (digit) represents a tag <strong>hit</strong>
(also called detection)</li>
<li>Each series of numbers represents a <strong>run</strong>
<ul>
<li>A run is a series of hits for an individual tag</li>
<li>For example, Tag A shows two runs (1 and 4), each with 6 hits</li>
</ul>
</li>
<li>A tag may be detected by more than one antenna at a time, and
therefore have multiple runs that overlap in time
<ul>
<li>For example, Tag C is detected on both antenna 1 and 2</li>
</ul>
</li>
</ul>
<p><strong>Overlapping Runs</strong></p>
<p>Technically, a specific tag should never have overlapping runs on a
single antenna, but this can happen in noisy environments with Lotek
tags (see <a href="05-data-cleaning.html#preliminary-filtering">Chapter
5 - Data Cleaning: Preliminary Filtering</a> for how to address these
false positives).</p>
<p>Overlapping runs would not happen with CTT tags because of the way
runs are built, but the rate of hits would still be expected to be
around 1 per second or lower.</p>
<p><strong>Determining tag identity</strong></p>
<p>For Lotek tags, multiple tags transmit the same ID, therefore a
distinctive period (time between hits) is used to differentiate among
tags with the same ID. Since Lotek tags cannot be identified by
individual hits, this means that runs are the fundamental unit of
detection.</p>
<p>The spacing between two hits is considered <em>compatible</em> with a
particular tag if it represents a multiple of the period length (this
allows for occasional missed hits). However, a run can have gaps
(missing hits) only up to a certain size. Beyond that size, measurement
error and clock drift are large enough that we can’t be sure that the
next detection is compatible or not.</p>
<p>For example, in the runs for Tag A (above) we’re not sure the gap
between the last detection in run 1 and the first detection in run 4 is
really compatible with tag A, so run 1 is ended and a new run is begun.
We could link runs 1 and 4 post-hoc, once we saw that run 4 was being
built with gaps compatible with tag A, but at present, the run-building
algorithm doesn’t backtrack.</p>
<p>In contrast, for CTT tags, there are 2<sup>32</sup> unique codes,
which ensures that each is unique, and the period is not distinct as it
may vary with power available from the photovoltaic cell.</p>
<p>Runs are assembled based on consecutive hits on a single antenna (or
node, if applicable), as long as they are not spaced by more than an
arbitrary period (600 seconds).</p>
</div>
<div class="section level3">
<h3 id="batches">Batches<a class="anchor" aria-label="anchor" href="#batches"></a>
</h3>
<p>A <strong>batch</strong> is the result of processing one collection
of raw data files from a receiver. Batches are not inherent in the data,
but instead reflect how data were processed. Batches arise in these
ways:</p>
<ul>
<li><p>a user visits an isolated receiver, downloads raw data files from
it, then uploads the files to motus.org once they are back from the
field</p></li>
<li><p>a receiver connected via WiFi, Ethernet, or cell modem is polled
for new data files; this typically happens roughly every hour, with
random jitter to smooth the processing load on the motus server</p></li>
<li><p>an archive of data files from a receiver is re-processed on the
motus server, because important metadata have changed (e.g. new or
changed tag deployment records), or because a significant change has
been made to processing algorithms.</p></li>
</ul>
<p>Batches are artificial divisions in the data stream, so runs of hits
will often cross batch boundaries. Adding this complication to the
picture above gives this:</p>
<pre><code>Receiver R
                                     Time -&gt;
       \=============|==============================|==================\
Tag A: / 1-----1--1--|--1-----1-----1         4---4-|---4--4------4--4-/
       \             |                              |                  \
Tag B: /             |  3-----3--3--3--3--3-----3---|-3--3             /
       \             |                              |                  \
Tag C: /  2--2---2--2|--2--2--2--2--2--2--2--2--2--2|--2--2--2--2--2   /
       \============================================|==================\
       &lt;-- Batch N -&gt;|&lt;-------- Batch N+1 ---------&gt;|&lt;--- Batch N+2 ---&gt;</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="false-positives">False positives<a class="anchor" aria-label="anchor" href="#false-positives"></a>
</h2>
<p>False positives (apparent detections of tags actually caused by other
sources) need to be taken into account. These can happen for quite a
number of reasons, and will sometimes affect Lotek and CTT tags in
different measure. False positives are difficult to identify, but there
are approaches to identify conditions in which the are more likely to
occur, and potential ways to mitigate them.</p>
<blockquote>
<p><strong>If you have any suggestions about techniques you are using to
separate true detections from false positives, we encourage you to share
them with us!</strong></p>
</blockquote>
<div class="section level3">
<h3 id="noisy-environments">Noisy environments<a class="anchor" aria-label="anchor" href="#noisy-environments"></a>
</h3>
<p>Radio noise from interference can create bursts that look like tags.
As the amount of radio pulses from other sources increases in the
environment, the expected number of false positives will also
increase.</p>
<p>See:</p>
<ul>
<li><a href="articles/05-data-cleaning.html#preliminary-filtering-1">Chapter 5
- Data Cleaning &gt; Preliminary Filtering</a></li>
<li><a href="articles/filtering.html">In-depth detections
filtering</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="bit-errors">Bit errors<a class="anchor" aria-label="anchor" href="#bit-errors"></a>
</h3>
<p>Actual tag signals may be incorrectly transmitted. Those should
rarely produce valid ID’s, but they will be more likely with CTT tags,
mostly because where is a very high number of possible combinations (4
billions). They should still rarely produce an ID of a tag actually
manufactured. In CTT tags, bit errors have been found to lead more often
to specific patterns (e.g. the last trailing digits being all 7 or F’s:
xxxFFFF due to only a partial signal being received). These patterns are
excluded from the list of valid tags.</p>
</div>
<div class="section level3">
<h3 id="aliasing">Aliasing<a class="anchor" aria-label="anchor" href="#aliasing"></a>
</h3>
<p>Aliasing occurs when the combination of multiple tags create the
appearance of a tag that is not present but matches another known tag.
This can happen in at least 2 ways:</p>
<ol style="list-style-type: decimal">
<li>2 tags with distinct ID’s, but with the same period (both Lotek and
CTT).</li>
<li>2 tags with the same ID, but with distinct periods (only for
Lotek).</li>
</ol>
<p>In the first case, if the burst of both tags overlap, they may
interfere with each other and create the appearance of a new tag for a
time. Assuming that the 2 tags do not have exactly the same period,
their bursts should eventually drift apart and the alias is not expected
to persist over a very long run.</p>
<p>In the second case, if you have multiple tags with the same ID but
distinct periods, this could also result in new periods, but those would
exceed 2 consecutive hits (run length = 2) only rarely.</p>
<p>Both types of aliasing is mostly problematic in environments where
you have many tags present simultaneously which increases the incidence
of overlapping tags (e.g. colonies).</p>
<p>Manufacturers for both Lotek and CTT tags have integrated various
methods to reduce the incidence of false detections into their
proprietary technologies. Data collected by Sensor Gnomes are processed
by the “Tag finder”, which looks at properties of the signal to exclude
likely false positives (e.g. higher deviation in the frequency of pulses
within a burst). The parameters can potentially be adjusted, but an
aggressive approach aimed at reducing false positives will also result
in an increase in false negatives.</p>
<p>See:</p>
<ul>
<li><a href="articles/05-data-cleaning.html#ambiguous">Chapter 5 - Data
Cleaning &gt; Examining ambiguous detections</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="run-length">Run length<a class="anchor" aria-label="anchor" href="#run-length"></a>
</h3>
<p>With both types of tag technologies, the likelihood of obtaining
false positives should decrease as the run length increases.</p>
<p>For Lotek tags, we generally recommend ignoring runs comprised only
of 2 or 3 hits. Some probably relate to real tag detections, but the
vast majority probably do not.</p>
<p>For CTT tags, we do not yet have a suggested minimum threshold. In
most cases, given that tag period is short, one would expect that true
single-hit runs would be quite rare, so those should be excluded. With
the exception of some specific tag IDs more prone to error, the
likelihood of obtaining the same false ID in consecutive detections is
probably very low. Runs of 2 detections or more are probably safe in
most instances.</p>
</div>
<div class="section level3">
<h3 id="missed-detections">Missed detections<a class="anchor" aria-label="anchor" href="#missed-detections"></a>
</h3>
<p>False positives should more often lead to gaps in detections during a
run. A run that contains several gaps in detection would therefore be
deemed less reliable. A simple metric for this would be to divide the
number of hits in a run (the run length) by the duration of the run
(tsEnd - tsStart). Longer runs with few or no gaps in detection would be
optimal.</p>
</div>
<div class="section level3">
<h3 id="overlapping-runs">Overlapping runs<a class="anchor" aria-label="anchor" href="#overlapping-runs"></a>
</h3>
<p>Runs of the same tag on the same antenna should also be an indication
of false positives, but this should be highly correlated with the number
and/or ratio of short runs described above.</p>
</div>
<div class="section level3">
<h3 id="spatio-temporal-models">Spatio-temporal models<a class="anchor" aria-label="anchor" href="#spatio-temporal-models"></a>
</h3>
<p>State-space models and other approach can be used to assess whether
movement make sense from a biological point of view, and can help assign
probabilities that individual detections are valid.</p>
</div>
</div>
<div class="section level2">
<h2 id="false-negatives">False negatives<a class="anchor" aria-label="anchor" href="#false-negatives"></a>
</h2>
<p>False negatives are usually even more difficult to detect.</p>
<ul>
<li><p>Faulty equipement or installation is always possible of course.
Please refer to the installation guidelines to make sure you follow all
the recommendations.</p></li>
<li><p>DO NOT FORGET to register your tags! (details here)</p></li>
<li><p>DO NOT FORGET to activate your tags before deploying
them!</p></li>
<li><p>Make sure that you report your tag and receiver deployment
details BEFORE uploading your data. Motus tag finder only seek tags that
are known to be deployed.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="complications">Complications<a class="anchor" aria-label="anchor" href="#complications"></a>
</h2>
<p>The picture above is complicated by several facts:</p>
<ul>
<li><p>receivers are often deployed to isolated areas so that we can
only obtain raw data from them occasionally</p></li>
<li><p>receivers are not aware of the full set of currently-active
tags</p></li>
<li><p>sensorgnome receivers do not “know” the full Lotek code set; they
record pulses thought to be from Lotek coded ID tags, but are only able
to assemble them into tag hits for a small set of tags for which they
have an on-board database, built from the user’s own recordings of their
tags. This limitation is due to restrictions in the agreement between
Lotek and Acadia University for our use of their codeset.</p></li>
<li><p>Lotek receivers report each detected tagID independently, and do
not assemble them into runs. This means a raw Lotek .DTA file does not
distinguish between tag 123:4.5 and tag 123:9.1 (i.e. between tags with
ID <code>123</code> and burst intervals 4.5 seconds and 9.1
seconds).</p></li>
</ul>
<p>This means that:</p>
<ul>
<li>
<p>raw receiver data must be processed on a server with full
knowledge of:</p>
<ul>
<li><p>which tags are deployed and likely active</p></li>
<li><p>the Lotek codeset(s)</p></li>
</ul>
</li>
<li><p>raw data must be processed in incremental batches</p></li>
<li><p>processed data should be distributed to users in incremental
batches, especially if they wish to obtain results “as they arrive”,
rather than in one lump after all their tags have expired.</p></li>
</ul>
<div class="section level3">
<h3 id="boot">Receiver Boot Sessions<a class="anchor" aria-label="anchor" href="#boot"></a>
</h3>
<p>A receiver <strong>reboots</strong> when it is powered down and then
(possibly much later) powered back up. A boot session is defined as the
period between reboots. Reboots often correspond to a receiver:</p>
<ul>
<li>being redeployed</li>
<li>having its software updated</li>
<li>or having a change made to its attached radios,</li>
</ul>
<p>Motus treats receiver reboots in a special way:</p>
<ul>
<li><p>a reboot always begins a new batch; i.e. batches never extend
across reboots. This simplifies determination of data ownership. For
example, all data in a boot session (time period between consecutive
reboots) are deemed to belong to the same Motus project. This reflects
the fact that a receiver is (almost?) always turned off between the time
it is deployed by one project, and the time it is redeployed by another
project.</p></li>
<li><p>any active tag runs are ended when a receiver reboots. Even if
the same tag is present and broadcasting, and even if the reboot takes
only a few minutes, hits of a tag before and after the reboot will
belong to separate runs. This is partly for convenience in determining
data ownership, as mentioned above. It is also necessary because
sometimes receiver clocks are not properly set by the GPS after a
reboot, and so the timestamps for that boot session will revert to a
machine default, e.g. 1 Jan 2000. Although runs from these boot sessions
could in principle be re-assembled post hoc if the system clock can be
pinned from information in field notes, this is not done automatically
at present.</p></li>
<li><p>parameters to the tag-finding algorithm are set on a per-batch
basis. At some field sites, we want to allow more lenient filtering
because there is very little radio noise. At other sites, filtering
should be more strict, because there is considerable noise and high
false-positive rates for tags. Motus allows projects to set parameter
overrides for individual receivers, and these overrides are applied by
boot session, because redeployments (always?) cause a reboot.</p></li>
<li><p>when reprocessing data (see below) from an archive of data files,
each boot session is processed as a batch.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="incremental-distribution-of-data">Incremental Distribution of Data<a class="anchor" aria-label="anchor" href="#incremental-distribution-of-data"></a>
</h3>
<p>The <a href="https://github.com/MotusWTS/motus/" class="external-link">motus R package</a>
allows users to build a local copy of the database of all their tags’
(or receivers’) hits incrementally. A user can regularly call the
<code><a href="../reference/tagme.html">tagme()</a></code> function to obtain any new hits of their tags.
Because data are processed in batches, <code><a href="../reference/tagme.html">tagme()</a></code> either does
nothing, or downloads one or more new batches of data into the user’s
local DB.</p>
<p>Each new batch corresponds to a set of files processed from a single
receiver. A batch record includes these items:<br>
- receiver device ID - how many of hits of their tags occurred in the
batch - first and last timestamp of the raw data processed in this
batch</p>
<p>Each new batch downloaded will include hits of one or more of the
user’s tags (or someone’s tags, if the batch is for a “receiver”
database).</p>
<p>A new batch might also include some GPS fixes, so that the user knows
where the receiver was when the tags were detected.</p>
<p>A new batch will include information about runs. This information
comes in three versions:</p>
<ul>
<li>information about a new run; i.e. one that begins in this batch</li>
<li>information about a continuing run; i.e. a run that began in a
previous batch, has some hits in this batch, and is not known to have
ended</li>
<li>information about an ending run; i.e. a run that began in a previous
batch, might have some hits in this batch, but which is also known to
end in this batch (because a sufficiently long time has elapsed since
the last detection of its tag)</li>
</ul>
<p>Although the unique <code>runID</code> identifier for a run doesn’t
change when the user calls <code><a href="../reference/tagme.html">tagme()</a></code>, the number of hits in
that run and its status (<code>done</code> or not), might change.</p>
</div>
</div>
<div class="section level2">
<h2 id="reprocessing-data">Reprocessing Data<a class="anchor" aria-label="anchor" href="#reprocessing-data"></a>
</h2>
<p>Motus will occasionally need to reprocess raw files from
receivers.<br>
There are several reasons:</p>
<ul>
<li>
<p><strong>New or modified tag deployment records</strong></p>
<p>The tag detection code relies on knowing the active life of each tag
it looks for, to control rates of false positive and false negative
hits. If the deployment record for a tag only reaches the server after
it has already processed raw files overlapping the tag’s deployment,
then those files will need to be reprocessed in order to (potentially)
find the tag therein. Similarly, if a tag was mistakenly sought during a
period when it was not deployed, it will have “used up” signals that
could instead have come from other tags, thereby causing both its own
false positives, and false negatives on other tags. (This is only true
for Lotek ID tags; CTT should be unaffected, provided deployed tags are
well dispersed in the ID codespace.)</p>
</li>
<li><p><strong>Bug fixes or improvements in the tag finding
algorithm</strong></p></li>
<li>
<p><strong>Corrections of mis-filed data from receivers</strong></p>
<p>Sometimes, duplication among receiver serial numbers (a rare event)
is only noticed <em>after</em> data from them has already been
processed. Those data will likely have to be reprocessed so that hits
are assigned to the correct station. Interleaved data from two receivers
having the same serial number will typically prevent hits from at least
one of them, as the tag finder ignores data where the clock seems to
have jumped backwards significantly.</p>
</li>
</ul>
<div class="section level3">
<h3 id="the-eventual-reprocessing-contract">The (eventual) Reprocessing Contract<a class="anchor" aria-label="anchor" href="#the-eventual-reprocessing-contract"></a>
</h3>
<p>Reprocessing can be very disruptive from the user’s point of view
(“What happened to my hits?”), so Motus reprocessing will be:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Optional</strong>: users should be able to obtain new
data without having to accept reprocessed versions of data they already
have.</p></li>
<li><p><strong>Reversible</strong>: users should be able to “go back” to
a previous version of any reprocessed data they have accepted.</p></li>
<li><p><strong>Transparent</strong>: users will receive a record of what
was reprocessed, why, when, what was done differently, and what
changed</p></li>
<li><p><strong>All-or-nothing</strong>: for each receiver boot session
for which users have data, these data must come entirely from either the
original processing, or a subsequent single reprocessing event. The user
<em>must not</em> end up with an undefined mix of data from original and
reprocessed sources.</p></li>
<li><p><strong>In-band</strong>: the user’s copy of data will be updated
to incorporate <em>reprocessed</em> data as part of the normal process
of updating to obtain <em>new</em> data, unless they choose otherwise.
We expect that most users will want to accept reprocessed data most of
the time.</p></li>
</ol>
<p>Initially, Motus data processing might not adhere to this contract,
but it is an eventual goal.</p>
</div>
<div class="section level3">
<h3 id="reprocessing-simplified">Reprocessing simplified<a class="anchor" aria-label="anchor" href="#reprocessing-simplified"></a>
</h3>
<p>Raw data records from an arbitrary stretch of time are complicated to
reprocess, because runs which cross the reprocessing boundaries might
lose or gain hits within the reprocessing period, but not outside of it.
This might even break an existing run into distinct new runs.</p>
<p>This would be challenging to formalize and represent in the database
if we want to maintain a full history of processing. For example, if
reprocessing deletes some hits from run <code>2</code>, how do we
represent both the old and the new versions of that run?</p>
<p>Therefore, for simplicity we <strong>choose reprocessing periods that
cross no runs</strong>. Currently, that means a boot session, <a href="#boot">as discussed above</a>.</p>
</div>
<div class="section level3">
<h3 id="distributing-reprocessed-data-eventual">Distributing reprocessed data (eventual)<a class="anchor" aria-label="anchor" href="#distributing-reprocessed-data-eventual"></a>
</h3>
<p>The previous section shows why we only reprocess data by boot
session. Given that, how do we get reprocessed data to users while
fulfilling the reprocessing contract?</p>
<p>Note that a reprocessed boot session will fully replace one or more
existing batches and one or more runs, because batches and runs both
nest within boot sessions.</p>
<p>Replacement of data by reprocessed versions should happen in-band
(point #5 above), so <strong>one <em>potential</em> approach</strong> is
this:</p>
<ul>
<li>the <code>batches_for_XXX</code> API entries should mark new batches
which result from reprocessing, so that the client can deal with them
appropriately. This can be done by adding a field called
<code>reprocessID</code> with these semantics:
<ul>
<li>
<code>reprocessID == 0</code>: data in this batch are from new raw
files; the normal situation</li>
<li>
<code>reprocessID == X &gt; 0</code>: data in this batch are from
reprocessing existing raw files.</li>
<li>
<code>X</code> is the ID of the reprocessing event, and a new API
entry <code>reprocessing_info (X)</code> can be called to obtain details
about it.</li>
<li>if the user chooses to accept the reprocessed version, then existing
batches, runs, hits and GPS fixes from the same receiver and boot
session are retired before adding the new batches.</li>
<li>if the user chooses to reject the reprocessed version, then
<code>X</code> is added to a client-side blacklist, and the user will
not receive any data from batches whose reprocessID is on the
blacklist.</li>
<li>later, if a user decides to accept a reprocessing event they had
earlier declined, then the IDs of new batches for that event can be
fetched from another new API <code>reprocessing_batches (X)</code>, and
the original batches will be deleted</li>
</ul>
</li>
<li>to let users more efficiently fetch the “best” version of their
dataset (i.e. accepting all reprocessing events), we should also mark
batches which are subsequently replaced by a reprocessing event. For
this, we add the field <code>replacedIn</code> with these semantics:
<ul>
<li>
<code>replacedIn == 0</code>: data in this batch have not been
replaced by any reprocessing event</li>
<li>
<code>replacedIn == X &gt; 0</code>: data in this batch have been
replaced by reprocessing event <code>X</code>. Then the client can
ignore any batches for which <code>replacedIn &gt; 0</code>. We could
also add a new boolean parameter <code>unreplacedOnly</code> to the
<code>batches_for_XXX</code> API entries. It defaults to
<code>false</code>, but if <code>true</code>, then only batches which
have not been replaced by subsequent reprocessing events are
returned.</li>
</ul>
</li>
<li>users can choose a policy for how reprocessed data are handled by
setting the value of <code>Motus$acceptReprocessedData</code> in their
workspace before calling <code><a href="../reference/tagme.html">tagme()</a></code>:
<ul>
<li>
<code>Motus$acceptReprocessedData &lt;- TRUE</code>; always accept
batches of data from reprocessing events</li>
<li>
<code>Motus$acceptReprocessedData &lt;- FALSE</code>; never accept
batches of data from reprocessing events</li>
<li>
<code>Motus$acceptReprocessedData &lt;- NA</code> (default); ask
about each reprocessing event</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>What Next?</strong> <a href="index.html">Explore all
articles</a></p>
</blockquote>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Birds Canada, John Brzustowski, Denis Lepage.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
