<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>In-depth detections filtering • motus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="In-depth detections filtering">
<meta property="og:description" content="motus">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">motus</a>
        <span class="version label label-info" data-toggle="tooltip" data-placement="bottom" title="Documentation overhaul">4.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/articles/motus.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/01-introduction.html">Chapter 1 - Introduction</a>
    </li>
    <li>
      <a href="../../articles/articles/02-installing-packages.html">Chapter 2 - Installing packages</a>
    </li>
    <li>
      <a href="../../articles/articles/03-accessing-data.html">Chapter 3 - Accessing detections data</a>
    </li>
    <li>
      <a href="../../articles/articles/04-deployments.html">Chapter 4 - Tag and receiver deployments</a>
    </li>
    <li>
      <a href="../../articles/articles/05-data-cleaning.html">Chapter 5 - Data Cleaning</a>
    </li>
    <li>
      <a href="../../articles/articles/06-exploring-data.html">Chapter 6 - Exploring detections data</a>
    </li>
    <li class="divider">
    <li>
      <a href="../../articles/index.html">More...</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="filtering_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>In-depth detections filtering</h1>
            
      
      
      <div class="hidden name"><code>filtering.Rmd</code></div>

    </div>

    
    
<p>Invariably you will run into some false detections in your tag detection data. Sometimes these may be due to random glitches or noisy radio conditions. The various outputs on the Motus web site are pre-filtered, but data downloaded via the <code>motus</code> R package provides access to <strong>all</strong> detections, allowing users more control over which detections to keep or omit.</p>
<p>Therefore, it is important to filter these out as part of your data cleaning process. <a href="05-data-cleaning.html">Chapter 5 - Data cleaning</a> is a good place to start for a walk-through), and in this article we’ll cover in more detail two methods of filtering out dubious hits based on radio noise (activity) and run lengths.</p>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">motus</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>

<span class="va">tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/tagme.html">tagme</a></span><span class="op">(</span><span class="fl">176</span>, update <span class="op">=</span> <span class="cn">TRUE</span>, new <span class="op">=</span> <span class="cn">FALSE</span>, dir <span class="op">=</span> <span class="st">"./data"</span><span class="op">)</span></code></pre></div>
<p>As runs are composed of sequences of hits, the longer the run the more confident we can be that it represents a true detection.</p>
<p>Run lengths are <code>runLen</code> in the <code>alltags</code> view.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">tags</span>, <span class="st">"alltags"</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hitID</span>, <span class="va">runID</span>, <span class="va">batchID</span>, <span class="va">motusTagID</span>, <span class="va">runLen</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 5]
## # Database: sqlite 3.36.0
## #   [/Users/runner/work/motus/motus/vignettes/articles/data/project-176.motus]
##     hitID runID batchID motusTagID runLen
##     &lt;int&gt; &lt;int&gt;   &lt;int&gt;      &lt;int&gt;  &lt;int&gt;
##  1  45107  8886      53      16047      5
##  2  45108  8886      53      16047      5
##  3  45109  8886      53      16047      5
##  4  45110  8886      53      16047      5
##  5  45111  8886      53      16047      5
##  6 199885 23305      64      16047     11
##  7 199886 23305      64      16047     11
##  8 199887 23305      64      16047     11
##  9 199888 23305      64      16047     11
## 10 199889 23305      64      16047     11
## # … with more rows</code></pre>
<p>However, local conditions at an individual receiver may vary in their exposure to background radio noise/interference. Sites with relatively more background noise may be more prone to generating a high number of very short runs that are in reality spurious data.</p>
<p>The <code>activity</code> table contains information on the number of runs (<code>numRuns</code>) and how many of these runs were particularly short (i.e. 2 hits <code>run2</code> or 3 hits <code>run3</code>, etc.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">tags</span>, <span class="st">"activity"</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">batchID</span>, <span class="va">motusDeviceID</span>, <span class="va">ant</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">hourBin</span>, <span class="va">numRuns</span>, <span class="va">run2</span>, <span class="va">run3</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 10]
## # Database: sqlite 3.36.0
## #   [/Users/runner/work/motus/motus/vignettes/articles/data/project-176.motus]
##    batchID motusDeviceID ant    year month   day hourBin numRuns  run2  run3
##      &lt;int&gt;         &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1      53           486 1      2015     9    25  400872       1     0     0
##  2      53           486 1      2015     9    30  401014       1     0     0
##  3      53           486 1      2015    10     8  401204       1     0     0
##  4      53           486 -1     2015     9    30  401014       1     1     0
##  5      53           486 -1     2015    10     8  401204       1     0     0
##  6      53           486 2      2015     9    30  401012       1     0     1
##  7      53           486 2      2015     9    30  401014       1     1     0
##  8      53           486 2      2015    10     8  401204       1     0     0
##  9      53           486 3      2015     9    21  400796       1     1     0
## 10      53           486 3      2015     9    25  400872       1     0     1
## # … with more rows</code></pre>
<p>Therefore a good first pass filter should use both the length of a run and the amount of radio activity (number of short runs) at a given site to determine whether or not to remove a run of hits.</p>
</div>
<div id="empirically-based-cutoffs" class="section level2">
<h2 class="hasAnchor">
<a href="#empirically-based-cutoffs" class="anchor"></a>Empirically-based cutoffs</h2>
<p>Based on these ideas and through empirical examination of data, the Motus team have determined a set of specific cutoffs that work well as a default filter.</p>
<p>In general, short runs (with a length of only 2 or 3) have a relatively high probability of being false positive detections. In contrast, long runs (with a length of 5 or more) have a high probability of being true positives. Therefore, runs with a length 3 or less are conservatively considered invalid, and runs with a length of 5 or more are considered valid.</p>
<p>At noisy sites, there is a greater chance of having spurious detections. Therefore, intermediate runs (with a length of 4), are considered valid at quiet sites, but likely invalid at noisy sites. Noisy sites are categorized as those with many runs (&gt;= 100) and a high ratio of runs with lengths of 2 at a given time (&gt;= 85%).</p>
</div>
<div id="filtering-in-motus" class="section level2">
<h2 class="hasAnchor">
<a href="#filtering-in-motus" class="anchor"></a>Filtering in <code>motus</code>
</h2>
<p>There are two filtering options in the <code>motus</code> R package that follow these ideas:</p>
<ol style="list-style-type: decimal">
<li>Easiest is the field/column called <code>motusFilter</code> found in the <code>runs</code> table <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
</li>
<li>More customizable, is the function called <code><a href="../../reference/filterByActivity.html">filterByActivity()</a></code>
</li>
</ol>
<div id="motusfilter" class="section level3">
<h3 class="hasAnchor">
<a href="#motusfilter" class="anchor"></a><code>motusFilter</code>
</h3>
<p>The column/field <code>motusFilter</code> in the <code>runs</code> table is a filter value created on the server that reflects</p>
<ol style="list-style-type: decimal">
<li>
<a href="#empirically-based-cutoffs">Empirically-based cutoffs</a> defined above</li>
<li>Some manual filtering based on aliasing or out-of-range records <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
</li>
</ol>
<p>This is a good first option for identifying detections that have a higher probability of being false. Currently the <code>motusFilter</code> contains just two values <code>0</code> or <code>1</code>. Runs with a <code>motusFilter</code> of <code>0</code> are considered “invalid” (i.e. have a low probability of being true detections) and could therefore be omitted.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">tags</span>, <span class="st">"runs"</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   table&lt;runs&gt; [?? x 10]
## # Database: sqlite 3.36.0
## #   [/Users/runner/work/motus/motus/vignettes/articles/data/project-176.motus]
##     runID batchIDbegin     tsBegin  tsEnd  done motusTagID ant     len nodeNum motusFilter
##     &lt;int&gt;        &lt;int&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;      &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;         &lt;int&gt;
##  1   8886           53 1445858390. 1.45e9     1      16047 3         5 &lt;NA&gt;              1
##  2  23305           64 1445857924. 1.45e9     1      16047 1        11 &lt;NA&gt;              1
##  3  23306           64 1445858341. 1.45e9     1      16047 3         6 &lt;NA&gt;              1
##  4  23307           64 1445858497. 1.45e9     1      16047 2         5 &lt;NA&gt;              1
##  5  23308           64 1445858826. 1.45e9     1      16047 2         5 &lt;NA&gt;              1
##  6 104118          141 1445858904. 1.45e9     1      16047 2         3 &lt;NA&gt;              0
##  7 104119          141 1445858875. 1.45e9     1      16047 3         3 &lt;NA&gt;              0
##  8 104120          141 1445858933. 1.45e9     1      16047 -1        2 &lt;NA&gt;              0
##  9 104131           97 1445855802. 1.45e9     1      16047 2         4 &lt;NA&gt;              1
## 10 104132           97 1445855812. 1.45e9     1      16047 3         5 &lt;NA&gt;              1
## # … with more rows</code></pre>
<p>To omit runs identified as dubious by <code>motusFilter</code> we can use an <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code> from the <code>dplyr</code> package.</p>
<p>First identify invalid runs with a <code>motusFilter</code> of 0</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bad_runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">tags</span>, <span class="st">"runs"</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">motusFilter</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>Now use <code><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join()</a></code> to remove those runs from the <code>alltags</code> view</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alltags_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">anti_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">tags</span>, <span class="st">"alltags"</span><span class="op">)</span>, <span class="va">bad_runs</span>, by <span class="op">=</span> <span class="st">"runID"</span><span class="op">)</span></code></pre></div>
<p>To double check we can filter for short runs in the original <code>alltags</code> view</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">tags</span>, <span class="st">"alltags"</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hitID</span>, <span class="va">runID</span>, <span class="va">batchID</span>, <span class="va">motusTagID</span>, <span class="va">runLen</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">runLen</span> <span class="op">&lt;=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 5]
## # Database: sqlite 3.36.0
## #   [/Users/runner/work/motus/motus/vignettes/articles/data/project-176.motus]
##     hitID  runID batchID motusTagID runLen
##     &lt;int&gt;  &lt;int&gt;   &lt;int&gt;      &lt;int&gt;  &lt;int&gt;
##  1 516095 104118     141      16047      3
##  2 516096 104118     141      16047      3
##  3 516097 104119     141      16047      3
##  4 516098 104119     141      16047      3
##  5 516099 104118     141      16047      3
##  6 516100 104119     141      16047      3
##  7 516101 104120     141      16047      2
##  8 516102 104120     141      16047      2
##  9 516132 104133      97      16047      2
## 10 516133 104133      97      16047      2
## # … with more rows</code></pre>
<p>And compare this to our newly created <code>alltags_filtered</code> table</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alltags_filtered</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hitID</span>, <span class="va">runID</span>, <span class="va">batchID</span>, <span class="va">motusTagID</span>, <span class="va">runLen</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">runLen</span> <span class="op">&lt;=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 5]
## # Database: sqlite 3.36.0
## #   [/Users/runner/work/motus/motus/vignettes/articles/data/project-176.motus]
## # … with 5 variables: hitID &lt;int&gt;, runID &lt;int&gt;, batchID &lt;int&gt;, motusTagID &lt;lgl&gt;,
## #   runLen &lt;int&gt;</code></pre>
<p>No more short runs, good!</p>
</div>
<div id="filterbyactivity" class="section level3">
<h3 class="hasAnchor">
<a href="#filterbyactivity" class="anchor"></a><code>filterByActivity()</code>
</h3>
<p>The <code>motusFilter</code> is one method of determining false detections, but Motus users are encouraged to explore alternative filter parameters.</p>
<p>By default, <code><a href="../../reference/filterByActivity.html">filterByActivity()</a></code> filters detections using the specific cutoffs defined above in <a href="#empirically-based-cutoffs">Empirically-based cutoffs</a>. However, users can fine-tune the filter by adjusting all these cutoffs.</p>
<p>To get the same results as our above example with <code>motusFilter</code>, we can use <code><a href="../../reference/filterByActivity.html">filterByActivity()</a></code> with the default arguments and only return <code>good</code> runs.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alltags_filtered2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/filterByActivity.html">filterByActivity</a></span><span class="op">(</span><span class="va">tags</span>, return <span class="op">=</span> <span class="st">"good"</span><span class="op">)</span></code></pre></div>
<p><strong>Note</strong> that <code><a href="../../reference/filterByActivity.html">filterByActivity()</a></code> requires the SQLite database connection (not a flat data frame).</p>
<p>If we compare hits, runs, and batches, we see that the two filtered data sets are identical (although this won’t always be the case<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test1</span> <span class="op">&lt;-</span> <span class="va">alltags_filtered</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hitID</span>, <span class="va">runID</span>, <span class="va">batchID</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">test2</span> <span class="op">&lt;-</span> <span class="va">alltags_filtered2</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hitID</span>, <span class="va">runID</span>, <span class="va">batchID</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu">waldo</span><span class="fu">::</span><span class="fu"><a href="https://waldo.r-lib.org/reference/compare.html">compare</a></span><span class="op">(</span><span class="va">test1</span>, <span class="va">test2</span><span class="op">)</span></code></pre></div>
<pre><code>## ✔ No differences</code></pre>
<p>Alternatively we can change the default view used, so the <code><a href="../../reference/filterByActivity.html">filterByActivity()</a></code> function uses the <code>alltagsGPS</code> view. <strong>However</strong>, on very large databases this could be slow.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alltags_filterd3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/filterByActivity.html">filterByActivity</a></span><span class="op">(</span><span class="va">tags</span>, return <span class="op">=</span> <span class="st">"all"</span>, view <span class="op">=</span> <span class="st">"alltagsGPS"</span><span class="op">)</span></code></pre></div>
<div id="customizing-the-filterbyactivity" class="section level4">
<h4 class="hasAnchor">
<a href="#customizing-the-filterbyactivity" class="anchor"></a>Customizing the <code>filterByActivity()</code>
</h4>
<p>The <code><a href="../../reference/filterByActivity.html">filterByActivity()</a></code> function uses the <code>activity</code> table to identify potentially problematic runs. As above, you can return just the “true” positives (<code>return = "good"</code>), but you can also return just the “false” positives (<code>return = "bad"</code>) or all runs (<code>return = "all"</code>). If you return <code>all</code> runs, you will also get a new column, <code>probability</code>, which reflects either 0 (expected false positive) or 1 (expected true positive), similar to the <a href="#motusfilter"><code>motusFilter</code> column</a>.</p>
<p>For example, the following code adds a <code>probability</code> column to the sample project data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alltags_filtered4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/filterByActivity.html">filterByActivity</a></span><span class="op">(</span><span class="va">tags</span>, return <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">hitID</span>, <span class="va">runID</span>, <span class="va">batchID</span>, <span class="va">motusTagID</span>, <span class="va">runLen</span>, <span class="va">probability</span><span class="op">)</span>

<span class="va">alltags_filtered4</span></code></pre></div>
<pre><code>## # Source:   lazy query [?? x 6]
## # Database: sqlite 3.36.0
## #   [/Users/runner/work/motus/motus/vignettes/articles/data/project-176.motus]
##     hitID runID batchID motusTagID runLen probability
##     &lt;int&gt; &lt;int&gt;   &lt;int&gt;      &lt;int&gt;  &lt;int&gt;       &lt;dbl&gt;
##  1  45107  8886      53      16047      5           1
##  2  45108  8886      53      16047      5           1
##  3  45109  8886      53      16047      5           1
##  4  45110  8886      53      16047      5           1
##  5  45111  8886      53      16047      5           1
##  6 199885 23305      64      16047     11           1
##  7 199886 23305      64      16047     11           1
##  8 199887 23305      64      16047     11           1
##  9 199888 23305      64      16047     11           1
## 10 199889 23305      64      16047     11           1
## # … with more rows</code></pre>
<p>You can adjust these parameters to be <strong>less strict</strong> (i.e., exclude fewer detections). For example, here we exclude all runs of length 2 or less (<code>minLen</code>), keep all runs of length 4 or more (<code>maxLen</code>), and will exclude any runs less than length 3 (2 &lt; run &lt; 4) from an hour which had more than 500 runs (<code>maxRuns</code>) and where at least 95% (<code>ratio</code>) of those runs have a run length of 2.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relaxed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/filterByActivity.html">filterByActivity</a></span><span class="op">(</span><span class="va">tags</span>, minLen <span class="op">=</span> <span class="fl">2</span>, maxLen <span class="op">=</span> <span class="fl">4</span>, 
                            maxRuns <span class="op">=</span> <span class="fl">500</span>, ratio <span class="op">=</span> <span class="fl">0.95</span>, 
                            return <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></code></pre></div>
<p>These parameters can also be <strong>more strict</strong> (i.e., exclude more detections). This next example excludes all runs of length 4 or less (<code>minLen</code>), keeps all runs of length 10 or more (<code>maxLen</code>), and will exclude any runs of length 5-9 (4 &lt; run &lt; 10) from hours which have more than 50 runs (<code>maxRuns</code>) and where at least 75% (<code>ratio</code>) of those runs have a run length of 2.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/filterByActivity.html">filterByActivity</a></span><span class="op">(</span><span class="va">tags</span>, minLen <span class="op">=</span> <span class="fl">4</span>, maxLen <span class="op">=</span> <span class="fl">10</span>, 
                           maxRuns <span class="op">=</span> <span class="fl">50</span>, ratio <span class="op">=</span> <span class="fl">0.75</span>, 
                           return <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></code></pre></div>
<p>Note that the filters may exclude some true detections in the process. Therefore, we recommend that after a full analysis of your data, you return to these detections and examine them individually, to determine (usually contextually) if they can be considered valid.</p>
</div>
</div>
</div>
<div id="exploring-problematic-detections" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-problematic-detections" class="anchor"></a>Exploring problematic detections</h2>
<p>You may also be interested more generally in exploring which data have only short run lengths. For example, the following code shows the maximum run length at all sites by month (for those runs which haven’t been removed by filtering).</p>
<p>Here we will collect and summarize by receiver and month maximum run lengths. We’ll convert <code>ts</code> to a datetime format with <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime()</a></code> from the lubridate package and we’ll use the <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code> function to pull out months.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_runlen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span><span class="op">(</span><span class="va">tags</span>, <span class="st">"alltags"</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ts <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op">(</span><span class="va">ts</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span>, <span class="co"># convert ts to POSIXct format</span>
         month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">recvDeployName</span>, <span class="va">month</span><span class="op">)</span> <span class="op"><a href="../../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>max.rl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">runLen</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'recvDeployName'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">max_runlen</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">recvDeployName</span>, y <span class="op">=</span> <span class="va">max.rl</span>, fill <span class="op">=</span> <span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="filtering_files/figure-html/unnamed-chunk-16-1.png" width="50%"></p>
<p>Alternatively, you can produce a list of sites where the maximum run length of detections was never greater than (say) 4, which may sometimes (but not always!) indicate they are simply false detections.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">max_runlen</span>, <span class="va">max.rl</span> <span class="op">&lt;</span> <span class="fl">5</span><span class="op">)</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">recvDeployName</span>, y <span class="op">=</span> <span class="va">max.rl</span>, fill <span class="op">=</span> <span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="filtering_files/figure-html/unnamed-chunk-17-1.png" width="50%"></p>
<p>It is impossible to go through every possible issue that you may encounter here. Users are strongly encouraged to explore their data fully, and make reasoned decisions on which detections are unlikely or indeterminate.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>If you are working with a dataset downloaded through <code><a href="../../reference/tagme.html">tagme()</a></code> prior to July 2019 it will not include those values. In those cases, you will either need to download a new copy of the entire dataset for your project or receiver, or to use the <code><a href="../../reference/filterByActivity.html">filterByActivity()</a></code> function described below to calculate the missing values.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Future version of the <code>motus</code> package should give users access to specific information on why each run was filtered (activity/noise or a manual assessment).<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Not <em>quite</em> the same because <code>motusFilter</code> does include some manual filtering.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Brzustowski, Denis LePage, Birds Canada.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
